/**
 * Generated by `js1 upgrade www-shared`.
 * @generated SignedSource<<671c6de58423e6fdfd55b6b08d616906>>
 *
 * Copyright 2004-present Facebook. All Rights Reserved.
 *
 * @format
 */

'use strict';

function isClassMethod(node) {
  return node.parent && node.parent.type === 'MethodDefinition';
}

function isClassProperty(node) {
  return node.parent && node.parent.type === 'ClassProperty';
}

function isObjectProperty(node) {
  return (
    node.parent &&
    node.parent.parent &&
    node.parent.parent.type === 'ObjectExpression'
  );
}

module.exports = function rule(context) {
  return {
    Identifier(node) {
      if (
        isClassMethod(node) ||
        isClassProperty(node) ||
        isObjectProperty(node)
      ) {
        const name = node.name;

        if (
          name === 'componentWillMount' ||
          name === 'componentWillReceiveProps' ||
          name === 'componentWillUpdate'
        ) {
          const message =
            `${node.name} has been renamed to UNSAFE_${node.name}.\n\n` +
            'Read more: https://fburl.com/react-deprecated-lifecycles';
          context.report({
            message,
            node,
            fix(fixer) {
              return fixer.replaceText(node, `UNSAFE_${node.name}`);
            },
          });
        }
      }
    },
  };
};
