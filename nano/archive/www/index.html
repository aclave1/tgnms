<html>
<head>
  <title>Network Analyzer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css"
     integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ=="
     crossorigin=""/>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" />
  <link rel="stylesheet" href="/styles/analyzer.css" />
</head>
<body>

<div id="navwrapper">
<nav class="navbar navbar-expand-md py-0 navbar-dark bg-dark">
  <a class="navbar-brand">
    <img class="logo" src="5g-3.png" width="80" height="45" alt="">
    <span class="brandname">extra &nbsp;&nbsp;&nbsp;&nbsp;Terragraph </span>
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse"
    data-target="#navbarTogglerDemo02" aria-controls="navbarTogglerDemo02"
    aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarTogglerDemo02">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item dropdown py-0">
        <a class="btn btn-secondary dropdown-toggle" href="#" role="button"
          id="linkTestRunDropdown" data-toggle="dropdown" aria-haspopup="true"
          aria-expanded="false"> Link Test</a>
        <ul class="dropdown-menu link_test_dropdown">
          <!-- <a class="dropdown-item" id="btnLinkTest" href="#">Single run</a> -->
          <form id="linkTestForm">
            <div class="form-group">
              <label for="emailLabel">Email address</label>
              <input type="email" class="form-control" id="linkEmailInput"
                placeholder="To obtain email notification" value="fsun@fb.com">
            </div>
            <div class="form-group">
              <label for="rateLabel">Traffic rate (Mbps)</label>
              <input type="text" class="form-control" id="linkRateInput" value=80
                placeholder="Rate (default 100Mbps)">
            </div>
            <div class="form-group">
              <label for="durationLabel">Duration (seconds)</label>
              <input type="text" class="form-control" id="linkDurationInput" value=250
                placeholder="Duration (default 300s)">
            </div>
            <div class="form-group form-check">
              <input type="checkbox" class="form-check-input" id="linkRepetitionInput">
              <label class="form-check-label" for="repetitionLabel">Repetitive run</label>
            </div>
          </form>
          <button id="btnLinkTest" class="btn btn-primary">Start</button>
        </ul>
      </li>
      <li class="nav-item dropdown py-0">
        <a class="btn btn-secondary dropdown-toggle" href="#" role="button"
          id="multihopTestRunDropdown"
          data-toggle="dropdown" aria-haspopup="true"
          aria-expanded="false"> Multihop Test</a>
        <ul class="dropdown-menu multihop_test_dropdown">
          <!-- <a class="dropdown-item" id="btnMultiHopUplinkTest"
            href="#">Uplink single run</a>
          <a class="dropdown-item" id="btnMultiHopDownlinkTest"
            href="#">Downlink single run</a> -->
            <form id="multihopTestForm">
              <div class="form-group">
                <label for="emailLabel">Email address</label>
                <input type="email" class="form-control" id="multihopEmailInput"
                  placeholder="To obtain email notification" value="fsun@fb.com">
              </div>
              <div class="form-group">
                <label for="rateLabel">Traffic rate (Mbps)</label>
                <input type="text" class="form-control" id="multihopRateInput" value=600
                  placeholder="Rate (default 100Mbps)">
              </div>
              <div class="form-group">
                <label for="durationLabel">Duration (seconds)</label>
                <input type="text" class="form-control" id="multihopDurationInput" value=120
                  placeholder="Duration (default 300s)">
              </div>
              <div class="form-group">
                <label for="sessionLabel">Sequential session num</label>
                <input type="text" class="form-control" id="multihopSessionInput" value=40
                  placeholder="Sessions (default 40)">
              </div>
              <div class="form-group">
              <input type="radio" id="downlinkRadio" name="multihopRadio" value = "downlink" checked>
              <label class="form-check-label" for="downlinkLabel">Downlink from PoP</label> <br>
              <input type="radio" id="uplinkRadio" name="multihopRadio" value ="uplink" unchecked>
              <label class="form-check-label" for="downlinkLabel">Uplink to PoP</label>
              </div>
            </form>
            <button id="btnMultiHopTest" class="btn btn-primary">Start</button>
        </ul>
      </li>
      <li class="nav-item dropdown py-0">
        <a class="btn btn-secondary dropdown-toggle" href="#" role="button"
          id="ignitionTestRunDropdown"
          data-toggle="dropdown" aria-haspopup="true"
          aria-expanded="false"> Ignition Test</a>
        <ul class="dropdown-menu">
          <a class="dropdown-item" id="btnIgnitionTest"
            href="#">Single run</a>
        </ul>
      </li>
      <!-- <li class="nav-item dropdown py-0">
        <a class="btn btn-secondary dropdown-toggle" href="#" role="button"
          id="IMScanRunDropdown"
          data-toggle="dropdown" aria-haspopup="true"
          aria-expanded="false"> IM Scan</a>
        <ul class="dropdown-menu">
          <a class="dropdown-item" id="btnIMScan"
            href="#">Single run</a>
        </ul>
      </li> -->
      <li>
      </li>
      <li class="nav-item dropdown py-0">
        <a class="btn btn-secondary dropdown-toggle" href="#" role="button"
          id="navbarDropdown" data-toggle="dropdown" aria-haspopup="true"
          aria-expanded="false"> Test History</a>
        <ul class="dropdown-menu">
          <li class="dropdown-item dropdown-submenu" id="linkTestHistory">
            <a class="dropdown-toggle" href="#" role="button"
              data-toggle="dropdown" style="color: black;">Link healthiness</a>
              <ul class="dropdown-menu" style="width: 250px;">
                <div id="linkTestDropdown"
                  style="overflow-y: scroll; height: 150px;">
                </div>
              </ul>
          </li>
          <li class="dropdown-item dropdown-submenu" id="multihopTestHistory">
            <a class="dropdown-toggle" href="#" role="button"
              data-toggle="dropdown" style="color: black;">Multihop</a>
            <ul class="dropdown-menu" style="width: 290px;">
              <div id="multihopTestDropdown"
                style="overflow-y: scroll; height: 150px;">
              </div>
            </ul>
          </li>
          <li class="dropdown-item dropdown-submenu" id="ignitionTestHistory">
            <a class="dropdown-toggle" href="#" role="button"
              data-toggle="dropdown" style="color: black;">Ignition</a>
            <ul class="dropdown-menu" style="width: 250px;">
              <div id="ignitionTestDropdown"
                style="overflow-y: scroll; height: 150px;">
              </div>
            </ul>
          </li>
          <!-- <li class="dropdown-item dropdown-submenu" id="IMScanHistory">
            <a class="dropdown-toggle" href="#" role="button"
              data-toggle="dropdown" style="color: black;">IM scan</a>
            <ul class="dropdown-menu" style="width: 250px;">
              <div id="IMScanDropdown"
                style="overflow-y: scroll; height: 150px;">
              </div>
            </ul>
          </li> -->
        </ul>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="btnStatus" href="#">Status</a>
      </li>
    </ul>
  </div>
</nav>
<nav class="navbar_narrow navbar-expand-md py-0 navbar-light"
  style="background-color: #edeeef">
  <button class="navbar-toggler ml-auto" type="button" data-toggle="collapse"
    data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown"
    aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNavDropdown">
    <ul class="navbar-nav mar-auto">
      <li class="nav-item">
        <input type="button" id="btnLegend"
          class="btn btn-outline-secondary btn-sm"
          value="Legend" onclick="toggleLegend();"></input>
      </li>
      <!-- <li class="nav-item">
        <input type="button" id="btnMapItTimer" value="Auto Refresh Results"
        class="btn btn-outline-secondary btn-sm"></input>
      </li> -->
      <li class="nav-item">
        <input type="button" id="btnTestSuspend" value="Suspend Test"
        class="btn btn-outline-secondary btn-sm"></input>
      </li>
    </ul>
    <ul class="navbar-nav ml-auto">
      <li class="nav-item">
        <input type="text" class="time"
          id="test_type" value="Test" readonly></input>
      </li>
      <li class="nav-item">
        <input type="text" class="time"
          id="start_time" value="Start Time" readonly></input>
      </li>
      <li class="nav-item">
        <input type="text" class="time"
          id="end_time" value="End Time" readonly></input>
      </li>
    </ul>
  </div>
</nav>
</div>

<div id="container"></div>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
  integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
  integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
  crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
  integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
  crossorigin="anonymous"></script>
<script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"
  integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log=="
  crossorigin=""></script>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="siteJsonData.js"></script>
<script src="nodeJsonData.js"></script>
<script src="linkJsonData.js"></script>
<script src="linkJsonDataudp.js"></script>
<script src="nodeJsonDataMultihop.js"></script>
<script src="linkJsonDataIgnition.js"></script>
<script src="/scripts/btnConfig.js"></script>
<script src="/scripts/leafletConfig.js"></script>
<script src="/scripts/legendRelated.js"></script>
<script src="/scripts/dataLoader.js"></script>
<script src="/scripts/testHistory.js"></script>
<script src="/scripts/statusParam.js"></script>
<script src="/scripts/initialLayers.js"></script>
<script src="/scripts/testRunStatus.js"></script>
<script>
getTestStatus("Result");
genDropdownItem("linkTestDropdown", "link_test_");
genDropdownItem("multihopTestDropdown", "multihop_test_");
genDropdownItem("ignitionTestDropdown", "ignition_test_");

// operation during run-time
$(document).ready(function () {
  // get request for test status update
  $('#btnStatus').click(function () {
    getTestStatus(""); //testType is empty
  });
  $('#btnLinkTest').click(function () {
    getTestStatus("Link healthiness");
    // reset the form
    // document.getElementById('linkTestForm').reset();
  });
  $('#btnMultiHopTest').click(function () {
    let isDownlink = $('#downlinkRadio').is(':checked');
    let isUplink = $('#uplinkRadio').is(':checked');
    if (isDownlink == true) {
      let multihopVal = confirm("Multihop sequential test"
        + " from PoP node to sectors " + "takes > 1 hr,"
        + " are you sure to continue?")
      if (multihopVal == true) {
        multihop_traffic = "downlink"
        getTestStatus("Multihop");
      }
    }
    if (isUplink == true) {
      let multihopVal = confirm("Multihop sequential test"
        + " from sectors to PoP node " + "takes > 1 hr,"
        + " are you sure to continue?")
      if (multihopVal == true) {
        multihop_traffic = "uplink"
        getTestStatus("Multihop");
      }
    }
  });
  // $('#btnMultiHopUplinkTest').click(function () {
  //   let multihopVal = confirm("Multihop sequential test"
  //     + " from sectors to PoP node " + "takes > 1 hr,"
  //     + " are you sure to continue?")
  //   if (multihopVal == true) {
  //     multihop_traffic = "uplink"
  //     getTestStatus("Multihop");
  //   }
  // });
  // $('#btnMultiHopDownlinkTest').click(function () {
  //   let multihopVal = confirm("Multihop sequential test"
  //     + " from PoP node to sectors " + "takes > 1 hr,"
  //     + " are you sure to continue?")
  //   if (multihopVal == true) {
  //     multihop_traffic = "downlink"
  //     getTestStatus("Multihop");
  //   }
  // });

  $('#btnIgnitionTest').click(function () {
    getTestStatus("Ignition");
  });
  $('#btnTestSuspend').click(function () {
    let suspendVal = confirm("Suspend current test run?")
    if (suspendVal == true) {
      getTestStatus("Suspend");
    }
  });
  $(".dropdown .dropdown-submenu").hover(
    function () {
      $('>.dropdown-menu', this).stop(true, true).fadeIn("fast");
      let testType;
      if (this.id === "linkTestHistory") {
        testType = "Link healthiness";
      } else if (this.id === "multihopTestHistory") {
        testType = "Multihop";
      } else if (this.id === "ignitionTestHistory") {
        testType = "Ignition";
      }
      fetchTestHistory(testType);
      setTimeout(function() {$(this).addClass('open');}, 10000);
    },
    function () {
      $('>.dropdown-menu', this).stop(true, true).fadeOut("fast");
      $(this).removeClass('open');
    }
  );
  loadHistoryBtnOperation("Link healthiness");
  loadHistoryBtnOperation("Multihop");
  loadHistoryBtnOperation("Ignition");
});
// $('#btnMapItTimer').click(function () {
//   getTestStatus("Result");
// });
</script>
</body>
</html>
